<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PrimeVision - AI-Powered Streaming Platform</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // Removed hide/dislike/toggle description behaviors for cleaner UI
    </script>


    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            color: #ffffff;
            overflow-x: hidden;
        }

        /* Align title and hide button horizontally */
        .title-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            width: 228.8px;
            /* Optional if you want to constrain width here */
            height: 32px;
            /* Maintain your fixed height */
            overflow: hidden;
        }

        /* Movie title styling */
        .movie-title1 {
            font-size: 20px;
            margin: 0;
            color: #fff;

            flex: 1 1 auto;
            /* Allow it to grow and shrink */
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            min-width: 0;
            /* Required for ellipsis inside flex container */
        }

        /* Removed legacy hide/toggle UI styles */


        /* Navigation Bar */
        .navbar {
            position: fixed;
            top: 0;
            right: 0;
            left: 280px;
            height: 80px;
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(51, 224, 178, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 2rem;
            z-index: 100;
            transition: all 0.3s ease;
        }

        .search-container {
            flex: 1;
            max-width: 500px;
            position: relative;
        }

        .search-input {
            width: 100%;
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 25px;
            padding: 12px 50px 12px 20px;
            color: #ffffff;
            font-size: 0.95rem;
            outline: none;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            border-color: #33E0B2;
            box-shadow: 0 0 0 3px rgba(51, 224, 178, 0.1);
        }

        .search-input::placeholder {
            color: #8892b0;
        }

        .search-btn {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #8892b0;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .search-btn:hover {
            color: #33E0B2;
        }

        /* Search Results Dropdown */
        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(51, 224, 178, 0.2);
            border-radius: 12px;
            margin-top: 8px;
            max-height: 400px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .search-result-item {
            padding: 12px 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .search-result-item:hover {
            background: rgba(51, 224, 178, 0.1);
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .search-result-image {
            width: 40px;
            height: 40px;
            border-radius: 6px;
            overflow: hidden;
        }

        .search-result-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .search-result-info h4 {
            color: #ffffff;
            font-size: 0.9rem;
            margin-bottom: 2px;
        }

        .search-result-info p {
            color: #8892b0;
            font-size: 0.8rem;
        }

        .auth-buttons {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .auth-btn {
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: 500;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
            font-size: 0.9rem;
        }

        .signin-btn {
            background: transparent;
            color: #8892b0;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .signin-btn:hover {
            color: #33E0B2;
            border-color: #33E0B2;
        }

        .signup-btn {
            background: linear-gradient(135deg, #33E0B2, #2BC4A0);
            color: #ffffff;
        }

        .signup-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(51, 224, 178, 0.3);
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 280px;
            height: 100vh;
            background: rgba(20, 20, 35, 0.95);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(51, 224, 178, 0.1);
            padding: 2rem 0;
            z-index: 101;
            transition: all 0.3s ease;
        }

        .logo-container {
            padding: 0 2rem 2rem 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 2rem;
        }

        .logo-container h1 {
            color: #33E0B2;
            font-size: 1.8rem;
            font-weight: 700;
            text-shadow: 0 0 15px rgba(51, 224, 178, 0.3);
        }

        .logo-container p {
            color: #8892b0;
            font-size: 1.2rem;
            margin-top: 0.5rem;
        }

        .nav-menu {
            list-style: none;
            padding: 0 1rem;
        }

        .nav-item {
            margin-bottom: 0.5rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            color: #8892b0;
            text-decoration: none;
            border-radius: 12px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .nav-link:hover,
        .nav-link.active {
            background: rgba(51, 224, 178, 0.1);
            color: #33E0B2;
            transform: translateX(5px);
        }

        .nav-icon {
            width: 20px;
            height: 20px;
            stroke: currentColor;
            fill: none;
            stroke-width: 2;
        }

        /* Main Content */
        .main-content {
            margin-left: 280px;
            margin-top: 80px;
            padding: 2rem;
            min-height: calc(100vh - 80px);
        }

        /* Hero Slider Section */
        .hero-section {
            position: relative;
            height: 500px;
            border-radius: 24px;
            margin-bottom: 3rem;
            overflow: hidden;
            border: 1px solid rgba(51, 224, 178, 0.2);
        }

        .hero-slider {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .hero-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(51, 224, 178, 0.1) 0%, rgba(43, 196, 160, 0.05) 100%);
            display: flex;
            align-items: center;
            padding: 3rem;
            opacity: 0;
            /* Enhanced slide transitions with transform and improved easing */
            transform: translateX(100px);
            transition: all 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            visibility: hidden;
        }

        .hero-slide.active {
            opacity: 1;
            transform: translateX(0);
            visibility: visible;
        }

        /* Added slide-out animation for smoother transitions */
        .hero-slide.slide-out {
            opacity: 0;
            transform: translateX(-100px);
            visibility: hidden;
        }

        .hero-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
            align-items: center;
            width: 100%;
        }

        /* Enhanced text animations with staggered entrance */
        .hero-text h1 {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #ffffff, #33E0B2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            transform: translateY(30px);
            opacity: 0;
            transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            transition-delay: 0.3s;
        }

        .hero-slide.active .hero-text h1 {
            transform: translateY(0);
            opacity: 1;
        }

        .hero-text p {
            font-size: 1.2rem;
            color: #8892b0;
            margin-bottom: 2rem;
            line-height: 1.6;
            transform: translateY(30px);
            opacity: 0;
            transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            transition-delay: 0.5s;
        }

        .hero-slide.active .hero-text p {
            transform: translateY(0);
            opacity: 1;
        }

        .hero-buttons {
            display: flex;
            gap: 1rem;
            transform: translateY(30px);
            opacity: 0;
            transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            transition-delay: 0.7s;
        }

        .hero-slide.active .hero-buttons {
            transform: translateY(0);
            opacity: 1;
        }

        .hero-btn {
            padding: 15px 30px;
            border-radius: 25px;
            font-weight: 600;
            text-decoration: none;
            /* Enhanced button transitions with smoother easing */
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            cursor: pointer;
            border: none;
            font-size: 1rem;
            position: relative;
            overflow: hidden;
        }

        /* Added ripple effect for buttons */
        .hero-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s ease, height 0.6s ease;
        }

        .hero-btn:hover::before {
            width: 300px;
            height: 300px;
        }

        /* Add to Favourites pill button */
        .add-fav-pill {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 14px;
            border-radius: 999px;
            border: 1px solid rgba(51,224,178,0.3);
            background: rgba(51,224,178,0.12);
            color: #33E0B2;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, background 0.2s ease, box-shadow 0.2s ease;
        }
        .add-fav-pill:hover { transform: translateY(-2px); background: rgba(51,224,178,0.18); box-shadow: 0 8px 24px rgba(51,224,178,0.25); }
        .add-fav-pill svg { width: 18px; height: 18px; }
        .add-fav-pill.added { background: rgba(76, 217, 100, 0.18); color: #4CD964; border-color: rgba(76, 217, 100, 0.35); }
        .toast {
            position: fixed; top: 20px; right: 20px; z-index: 2000;
            background: linear-gradient(135deg, #33E0B2, #2BC4A0); color: #fff;
            padding: 12px 16px; border-radius: 10px; font-weight: 600;
            box-shadow: 0 12px 30px rgba(51,224,178,0.35); opacity: 0; transform: translateY(-10px);
            transition: opacity .2s ease, transform .2s ease;
        }

        .primary-btn {
            background: linear-gradient(135deg, #33E0B2, #2BC4A0);
            color: #ffffff;
        }

        .primary-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 20px 40px rgba(51, 224, 178, 0.4);
        }

        .secondary-btn {
            background: transparent;
            color: #8892b0;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .secondary-btn:hover {
            color: #33E0B2;
            border-color: #33E0B2;
            background: rgba(51, 224, 178, 0.1);
            transform: translateY(-2px);
        }

        .hero-image {
            position: relative;
            text-align: center;
            transform: translateX(50px);
            opacity: 0;
            transition: all 1s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            transition-delay: 0.4s;
        }

        .hero-slide.active .hero-image {
            transform: translateX(0);
            opacity: 1;
        }

        .hero-character {
            width: 100%;
            max-width: 400px;
            height: auto;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            /* Enhanced image hover with smoother scaling and glow effect */
            transition: all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .hero-character:hover {
            transform: scale(1.08) rotateY(5deg);
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.4), 0 0 30px rgba(51, 224, 178, 0.2);
        }

        .toggle-desc-btn {
            background-color: #1A1A2EF2;
            color: #8892b0;
            border: none;
            /* padding: 8px 16px; */
            padding-top: 8px;
            font-size: 14px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            border-radius: 4px;
            user-select: none;
            transition: background-color 0.3s ease;
        }

        .toggle-desc-btn:hover {
            background-color: #1A1A2EF2;
        }

        .toggle-desc-btn .arrow {
            display: inline-block;
            margin-left: 8px;
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 6px solid #8892b0;
            transition: transform 0.3s ease;
        }

        /* Rotate arrow when active (description visible) */
        .toggle-desc-btn.active .arrow {
            transform: rotate(180deg);
        }

        /* Slider Navigation */
        .slider-nav {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 10;
        }

        .slider-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            cursor: pointer;
            /* Enhanced dot transitions with smoother scaling */
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
        }

        /* Added pulse animation for active dot */
        .slider-dot.active {
            background: #33E0B2;
            transform: scale(1.3);
            box-shadow: 0 0 15px rgba(51, 224, 178, 0.5);
        }

        .slider-dot.active::before {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            border: 2px solid rgba(51, 224, 178, 0.3);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        /* Added pulse keyframe animation */
        @keyframes pulse {
            0% {
                transform: scale(1);
                opacity: 1;
            }

            100% {
                transform: scale(1.5);
                opacity: 0;
            }
        }

        .slider-dot:hover {
            background: rgba(51, 224, 178, 0.7);
            transform: scale(1.2);
        }

        /* Content Sections */
        .content-section {
            margin-bottom: 3rem;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: #ffffff;
        }

        .view-all {
            color: #33E0B2;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .view-all:hover {
            color: #2BC4A0;
            text-shadow: 0 0 8px rgba(51, 224, 178, 0.5);
        }

        /* Movie Cards Grid */
        .movies-grid {
            display: flex;
            gap: 2rem;
            overflow-x: auto;
            overflow-y: hidden;
            padding: 1rem 0;
            scroll-behavior: smooth;
        }

        /* Custom scrollbar styling */
        .movies-grid::-webkit-scrollbar {
            height: 8px;
        }

        .movies-grid::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        .movies-grid::-webkit-scrollbar-thumb {
            background: #33E0B2;
            border-radius: 4px;
        }

        .movies-grid::-webkit-scrollbar-thumb:hover {
            background: #2BC4A0;
        }

        .movie-card {
            background: rgba(26, 26, 46, 0.8);
            border: 2px solid #33E0B2;
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            box-shadow:
                0 4px 15px rgba(0, 0, 0, 0.2),
                0 0 0 1px rgba(51, 224, 178, 0.1);
            flex: 0 0 280px;
            /* Fixed width, no shrinking */
            min-width: 280px;
        }

        .movie-card:hover {
            transform: translateY(-10px);
            box-shadow:
                0 20px 40px rgba(0, 0, 0, 0.4),
                0 0 20px rgba(51, 224, 178, 0.2);
        }

        /* Enhanced glow effect for movie cards */
        .movie-card:hover .movie-poster img {
            transform: scale(1.1);
        }

        .movie-poster {
            width: 100%;
            height: 200px;
            position: relative;
            overflow: hidden;
        }

        .movie-poster img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .movie-card:hover .movie-poster img {
            transform: scale(1.1);
        }

        .movie-info {
            padding: 1.5rem;
        }

        .movie-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #ffffff;
        }

        .movie-genre {
            color: #8892b0;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .movie-rating {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #33E0B2;
            font-weight: 500;
        }

        /* Continue Watching Section */
        .continue-watching {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
        }

        .continue-card {
            background: rgba(26, 26, 46, 0.8);
            border: 2px solid #33E0B2;
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            box-shadow:
                0 4px 15px rgba(0, 0, 0, 0.2),
                0 0 0 1px rgba(51, 224, 178, 0.1);
        }

        .continue-card:hover {
            transform: translateY(-5px);
            box-shadow:
                0 15px 30px rgba(0, 0, 0, 0.3),
                0 0 20px rgba(51, 224, 178, 0.2);
        }

        .continue-info {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .continue-poster {
            width: 80px;
            height: 60px;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }

        .continue-poster img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .continue-details h4 {
            color: #ffffff;
            margin-bottom: 0.5rem;
        }

        .continue-details p {
            color: #8892b0;
            font-size: 0.9rem;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            margin-top: 1rem;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #33E0B2, #2BC4A0);
            border-radius: 2px;
            transition: width 0.3s ease;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .navbar {
                left: 0;
            }

            .main-content {
                margin-left: 0;
            }

            .hero-content {
                grid-template-columns: 1fr;
                text-align: center;
            }

            .hero-text h1 {
                font-size: 2.5rem;
            }
        }

        @media (max-width: 768px) {
            .movies-grid {
                gap: 1rem;
            }

            .movie-card {
                flex: 0 0 250px;
                min-width: 250px;
            }

            .navbar {
                padding: 0 1rem;
            }

            .main-content {
                padding: 1rem;
            }

            .hero-section {
                height: 400px;
            }

            .hero-slide {
                padding: 2rem;
            }

            .hero-text h1 {
                font-size: 2rem;
            }

            .auth-buttons {
                gap: 0.5rem;
            }

            .auth-btn {
                padding: 8px 16px;
                font-size: 0.8rem;
            }
        }

        @media (max-width: 480px) {
            .movie-card {
                flex: 0 0 200px;
                min-width: 200px;
            }

            .search-container {
                display: none;
            }

            .hero-buttons {
                flex-direction: column;
                align-items: center;
            }
        }

        /* Mobile Menu Toggle */
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            color: #8892b0;
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .mobile-menu-toggle:hover {
            color: #33E0B2;
        }

        @media (max-width: 1024px) {
            .mobile-menu-toggle {
                display: block;
            }
        }

        /* Animations */
        /* Enhanced fadeInUp animation with better easing */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(40px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Added smooth entrance animation for movie cards */
        .movie-card {
            animation: fadeInUp 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
            opacity: 0;
        }

        .movie-card:nth-child(1) {
            animation-delay: 0.1s;
        }

        .movie-card:nth-child(2) {
            animation-delay: 0.2s;
        }

        .movie-card:nth-child(3) {
            animation-delay: 0.3s;
        }

        .movie-card:nth-child(4) {
            animation-delay: 0.4s;
        }

        /* Removed all infinite slider CSS styles and restored original grid layout */

        /* Adjust grid for smaller screens */
        @media (max-width: 1200px) {
            .movies-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .continue-watching {
                grid-template-columns: 1fr;
                /* Stack on small mobile */
                gap: 1rem;
            }

            .continue-card {
                padding: 1rem;
            }

            .continue-details h4 {
                font-size: 1rem;
            }

            .continue-details p {
                font-size: 0.8rem;
            }
        }

        @media (max-width: 480px) {
            .main-content {
                padding: 0.5rem;
            }

            .hero-section {
                height: 350px;
                padding: 1rem;
            }

            .hero-slide {
                padding: 1.5rem;
            }

            .hero-text h1 {
                font-size: 1.8rem;
            }

            .hero-text p {
                font-size: 0.9rem;
                margin-bottom: 1rem;
            }

            .hero-buttons {
                flex-direction: column;
                gap: 0.8rem;
            }

            .hero-btn {
                padding: 10px 20px;
                font-size: 0.9rem;
            }

            .section-title {
                font-size: 1.5rem;
            }

            .view-all {
                font-size: 0.9rem;
            }
        }

        .greeting-text {
            color: #8892b0;
            font-size: 1.2rem;
            font-weight: 500;
            margin-top: 0.3rem;
            margin-left: 2px;
            transition: color 0.3s ease;
        }

        /* New Trailer Popup Styles (Copied from trailers.html) */
        .trailer-popup-container {
            display: none;
            /* Hidden by default */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            padding: 20px;
            box-sizing: border-box;
            align-items: center;
            justify-content: center;
            flex-direction: row;
            /* Default for larger screens */
        }

        .trailer-player-section {
            flex: 2;
            /* Takes more space */
            max-width: 60%;
            /* Max width for video */
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding-right: 20px;
            /* Space between video and details */
        }

        .trailer-player-section iframe {
            width: 100%;
            height: 80vh;
            /* Responsive height */
            border-radius: 12px;
            border: 2px solid rgba(51, 224, 178, 0.4);
            box-shadow: 0 0 20px rgba(51, 224, 178, 0.5);
        }

        .movie-details-section {
            flex: 1;
            /* Takes less space */
            max-width: 40%;
            /* Max width for details */
            background: rgba(26, 26, 46, 0.95);
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            overflow-y: auto;
            /* Enable scrolling for long descriptions */
            max-height: 80vh;
            /* Match video height */
        }

        .movie-details-section h2 {
            font-size: 2rem;
            color: #33E0B2;
            margin-bottom: 1rem;
            text-shadow: 0 0 10px rgba(51, 224, 178, 0.3);
        }

        .movie-details-section p {
            font-size: 1rem;
            color: #b0b8c9;
            margin-bottom: 0.8rem;
            line-height: 1.5;
        }

        .movie-details-section p:last-of-type {
            margin-bottom: 0;
        }

        .close-popup-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 2.5rem;
            color: #33E0B2;
            cursor: pointer;
            transition: color 0.3s ease, transform 0.3s ease;
            z-index: 1001;
        }

        .close-popup-btn:hover {
            color: #2BC4A0;
            transform: rotate(90deg);
        }

        /* Responsive adjustments for the popup */
        @media (max-width: 1024px) {
            .trailer-popup-container {
                flex-direction: column;
                /* Stack vertically on smaller screens */
                padding: 15px;
            }

            .trailer-player-section {
                max-width: 100%;
                padding-right: 0;
                margin-bottom: 15px;
            }

            .trailer-player-section iframe {
                height: 50vh;
                /* Adjust height for mobile */
            }

            .movie-details-section {
                max-width: 100%;
                max-height: 40vh;
                /* Adjust height for mobile */
                padding: 1.5rem;
            }

            .movie-details-section h2 {
                font-size: 1.5rem;
            }

            .movie-details-section p {
                font-size: 0.9rem;
            }

            .close-popup-btn {
                font-size: 2rem;
                top: 10px;
                right: 10px;
            }
        }

        @media (max-width: 768px) {
            .trailer-player-section iframe {
                height: 40vh;
            }

            .movie-details-section {
                max-height: 35vh;
            }
        }

        @media (max-width: 480px) {
            .trailer-player-section iframe {
                height: 30vh;
            }

            .movie-details-section {
                max-height: 30vh;
                padding: 1rem;
            }

            .movie-details-section h2 {
                font-size: 1.2rem;
            }

            .movie-details-section p {
                font-size: 0.8rem;
            }
        }

        /* Added infinite slider styles */
        .greeting-text {
            color: #8892b0;
            font-size: 1.2rem;
            font-weight: 500;
            margin-top: 0.3rem;
            margin-left: 2px;
            transition: color 0.3s ease;
        }
    </style>
</head>

<body>
    <!-- Sidebar Navigation -->
    <nav class="sidebar" id="sidebar">
        <div class="logo-container">
            <h1>PrimeVision</h1>
            <p id="greeting" class="greeting-text"></p>
        </div>

        <ul class="nav-menu">
            <li class="nav-item">
                <a href="#" class="nav-link active">
                    <svg class="nav-icon" viewBox="0 0 24 24">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                        <polyline points="9,22 9,12 15,12 15,22" />
                    </svg>
                    Home
                </a>
            </li>
            <li class="nav-item">
                <a href="views/explore.html" class="nav-link">
                    <svg class="nav-icon" viewBox="0 0 24 24">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.35-4.35"></path>
                    </svg>
                    Explore
                </a>
            </li>
            <li class="nav-item">
                <a href="views/favourites.html" class="nav-link">
                    <svg class="nav-icon" viewBox="0 0 24 24">
                        <path
                            d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
                    </svg>
                    Favourites
                </a>
            </li>
            <li class="nav-item">
                <a href="views/profile.html" class="nav-link">
                    <svg class="nav-icon" viewBox="0 0 24 24">
                        <path
                            d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
                    </svg>
                    Profile
                </a>
            </li>
            <li class="nav-item">
                <a href="views/subscription.html" class="nav-link">
                    <svg class="nav-icon" viewBox="0 0 24 24">
                        <path
                            d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82V9a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" />
                    </svg>
                    Subscription
                </a>
            </li>
        </ul>
    </nav>
    <!-- Top Navigation Bar -->
    <header class="navbar">
        <button class="mobile-menu-toggle" id="mobileMenuToggle">â˜°</button>

        <div class="search-container">
            <input type="text" class="search-input" placeholder="Search movies, shows, actors..." id="searchInput">
            <button class="search-btn" id="searchBtn">
                <svg width="20" height="20" viewBox="0 0 24  24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8" />
                    <path d="m21 21-4.35-4.35" />
                </svg>
            </button>
            <div class="search-results" id="searchResults"></div>
        </div>

        <div class="auth-buttons">
            <!--       <a href="views/login.html" class="auth-btn signin-btn">Sign In</a> -->
            <a href="views/login.html" class="auth-btn signup-btn">Sign Up</a>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Hero Slider Section -->
        <section class="hero-section">
            <div class="hero-slider">
                <!-- Slide 1 - Stranger Things -->
                <div class="hero-slide active">
                    <div class="hero-content">
                        <div class="hero-text">
                            <h1>Stranger Things</h1>
                            <p>When a young boy vanishes, a small town uncovers a mystery involving secret experiments,
                                terrifying supernatural forces, and one strange little girl. Experience the supernatural
                                thriller that captivated millions worldwide.</p>
                            <div class="hero-buttons">
                                <a href="views/login.html" class="hero-btn primary-btn">Watch Now</a>
                                <a href="#" class="hero-btn secondary-btn">Add to List</a>
                            </div>
                        </div>
                        <div class="hero-image">
                            <img src="./images/stranger_things.jpg" alt="Stranger Things" class="hero-character">
                        </div>
                    </div>
                </div>

                <!-- Slide 2 - The Witcher -->
                <div class="hero-slide">
                    <div class="hero-content">
                        <div class="hero-text">
                            <h1>The Witcher</h1>
                            <p>Geralt of Rivia, a solitary monster hunter, struggles to find his place in a world where
                                people often prove more wicked than beasts. Follow the epic fantasy adventure based on
                                the bestselling novels.</p>
                            <div class="hero-buttons">
                                <a href="views/login.html" class="hero-btn primary-btn">Watch Now</a>
                                <a href="#" class="hero-btn secondary-btn">Add to List</a>
                            </div>
                        </div>
                        <div class="hero-image">
                            <img src="./images/witcher.webp" alt="The Witcher" class="hero-character">
                        </div>
                    </div>
                </div>

                <!-- Slide 3 - Breaking Bad -->
                <div class="hero-slide">
                    <div class="hero-content">
                        <div class="hero-text">
                            <h1>Breaking Bad</h1>
                            <p>A high school chemistry teacher diagnosed with inoperable lung cancer turns to
                                manufacturing and selling methamphetamine to secure his family's future. The critically
                                acclaimed crime drama that redefined television.</p>
                            <div class="hero-buttons">
                                <a href="views/login.html" class="hero-btn primary-btn">Watch Now</a>
                                <a href="#" class="hero-btn secondary-btn">Add to List</a>
                            </div>
                        </div>
                        <div class="hero-image">
                            <img src="./images/breakingbad.avif" alt="Breaking Bad" class="hero-character">
                        </div>
                    </div>
                </div>

                <!-- Slide 4 - The Mandalorian -->
                <div class="hero-slide">
                    <div class="hero-content">
                        <div class="hero-text">
                            <h1>The Mandalorian</h1>
                            <p>After the fall of the Galactic Empire, lawlessness has spread throughout the galaxy. A
                                lone gunfighter makes his way through the outer reaches, earning his keep as a bounty
                                hunter in the Star Wars universe.</p>
                            <div class="hero-buttons">
                                <a href="views/login.html" class="hero-btn primary-btn">Watch Now</a>
                                <a href="#" class="hero-btn secondary-btn">Add to List</a>
                            </div>
                        </div>
                        <div class="hero-image">
                            <img src="./images/mandalorian.jpg" alt="The Mandalorian" class="hero-character">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Slider Navigation -->
            <div class="slider-nav">
                <div class="slider-dot active" data-slide="0"></div>
                <div class="slider-dot" data-slide="1"></div>
                <div class="slider-dot" data-slide="2"></div>
                <div class="slider-dot" data-slide="3"></div>
            </div>
        </section>

        <!-- Continue Watching Section -->
        <section class="content-section">
            <div class="section-header">
                <h2 class="section-title">Continue Watching</h2>
                <a href="#" class="view-all">View All</a>
            </div>
            <div class="continue-watching" id="continueWatchingContainer">
                <!-- Dynamic content will be loaded here -->
            </div>
        </section>

        <!-- You Might Like Section -->
        <section class="content-section">
            <div class="section-header">
                <h2 class="section-title">You might like</h2>
                <a href="#" class="view-all" id="viewAllYouMightLike">View All</a>
            </div>
            <!-- Replacing additional cards in You Might Like section with complete reference cards -->
            <div class="movies-grid" id="youMightLikeGrid"></div>
        </section>
        

        <!-- Popular Now Section -->
        <section class="content-section">
            <div class="section-header">
                <h2 class="section-title">Popular Now</h2>
                <a href="#" class="view-all">View All</a>
            </div>
            <div class="movies-grid" id="popularNowGrid"></div>
        </section>

        <!-- Recommendations Section -->
        <section class="content-section">
            <div class="section-header">
                <h2 class="section-title">Recommended For You</h2>
            </div>
            <div id="recommendations-container" class="recommendations-section">
                <p class="recommendation-prompt">Click on any movie to get personalized recommendations</p>
            </div>
        </section>
    </main>

    <!-- Added footer section matching homepage design -->
    <footer
        style="background: rgba(20, 20, 35, 0.95); border-top: 1px solid rgba(51, 224, 178, 0.1); padding: 3rem 2rem 2rem; margin-top: 4rem;">
        <div
            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem; margin-bottom: 2rem;">
            <div>
                <h3 style="color: #33E0B2; font-size: 1.2rem; font-weight: 600; margin-bottom: 1rem;">Company</h3>
                <ul style="list-style: none;">
                    <li style="margin-bottom: 0.5rem;"><a href="#"
                            style="color: #8892b0; text-decoration: none; transition: color 0.3s ease;">About Us</a>
                    </li>
                    <li style="margin-bottom: 0.5rem;"><a href="#"
                            style="color: #8892b0; text-decoration: none; transition: color 0.3s ease;">Careers</a></li>
                    <li style="margin-bottom: 0.5rem;"><a href="#"
                            style="color: #8892b0; text-decoration: none; transition: color 0.3s ease;">Press</a></li>
                    <li style="margin-bottom: 0.5rem;"><a href="#"
                            style="color: #8892b0; text-decoration: none; transition: color 0.3s ease;">Blog</a></li>
                </ul>
            </div>
            <div>
                <h3 style="color: #33E0B2; font-size: 1.2rem; font-weight: 600; margin-bottom: 1rem;">Support</h3>
                <ul style="list-style: none;">
                    <li style="margin-bottom: 0.5rem;"><a href="#"
                            style="color: #8892b0; text-decoration: none; transition: color 0.3s ease;">Help Center</a>
                    </li>
                    <li style="margin-bottom: 0.5rem;"><a href="#"
                            style="color: #8892b0; text-decoration: none; transition: color 0.3s ease;">Contact Us</a>
                    </li>
                    <li style="margin-bottom: 0.5rem;"><a href="#"
                            style="color: #8892b0; text-decoration: none; transition: color 0.3s ease;">Terms of
                            Service</a></li>
                    <li style="margin-bottom: 0.5rem;"><a href="#"
                            style="color: #8892b0; text-decoration: none; transition: color 0.3s ease;">Privacy
                            Policy</a></li>
                </ul>
            </div>
            <div>
                <h3 style="color: #33E0B2; font-size: 1.2rem; font-weight: 600; margin-bottom: 1rem;">Features</h3>
                <ul style="list-style: none;">
                    <li style="margin-bottom: 0.5rem;"><a href="#"
                            style="color: #8892b0; text-decoration: none; transition: color 0.3s ease;">Premium</a></li>
                    <li style="margin-bottom: 0.5rem;"><a href="#"
                            style="color: #8892b0; text-decoration: none; transition: color 0.3s ease;">Mobile App</a>
                    </li>
                    <li style="margin-bottom: 0.5rem;"><a href="#"
                            style="color: #8892b0; text-decoration: none; transition: color 0.3s ease;">Downloads</a>
                    </li>
                    <li style="margin-bottom: 0.5rem;"><a href="#"
                            style="color: #8892b0; text-decoration: none; transition: color 0.3s ease;">Gift Cards</a>
                    </li>
                </ul>
            </div>
            <div>
                <h3 style="color: #33E0B2; font-size: 1.2rem; font-weight: 600; margin-bottom: 1rem;">Connect</h3>
                <ul style="list-style: none;">
                    <li style="margin-bottom: 0.5rem;"><a href="#"
                            style="color: #8892b0; text-decoration: none; transition: color 0.3s ease;">Facebook</a>
                    </li>
                    <li style="margin-bottom: 0.5rem;"><a href="#"
                            style="color: #8892b0; text-decoration: none; transition: color 0.3s ease;">Twitter</a></li>
                    <li style="margin-bottom: 0.5rem;"><a href="#"
                            style="color: #8892b0; text-decoration: none; transition: color 0.3s ease;">Instagram</a>
                    </li>
                    <li style="margin-bottom: 0.5rem;"><a href="#"
                            style="color: #8892b0; text-decoration: none; transition: color 0.3s ease;">YouTube</a></li>
                </ul>
            </div>
        </div>
        <div
            style="border-top: 1px solid rgba(255, 255, 255, 0.1); padding-top: 2rem; text-align: center; color: #8892b0;">
            <p>&copy; 2024 PrimeVision. All rights reserved.</p>
        </div>
    </footer>

    <!-- New Trailer Popup (Moved from trailers.html) -->
    <div class="trailer-popup-container" id="trailerPopup">
        <span class="close-popup-btn" id="closePopup">&times;</span>
        <div class="trailer-player-section">
            <iframe id="trailerPlayer" src="about:blank" frameborder="0" allow="autoplay; encrypted-media"
                allowfullscreen></iframe>
        </div>
        <div class="movie-details-section">
            <h2 id="popupMovieTitle"></h2>
            <p id="popupMovieGenre"></p>
            <p id="popupMovieRating"></p>
            <p id="popupMovieDescription"></p>
        </div>
    </div>

    <script>
        // Sample data for search functionality
        const searchData = [
            { title: "Chernobyl", genre: "Drama", type: "Series", rating: 9.4, image: "../images/chernobyl.jpg" },
            { title: "Snowpiercer", genre: "Sci-Fi", type: "Series", rating: 7.0, image: "../images/snowpiercer.jpg" },
            { title: "The Platform", genre: "Thriller", type: "Movie", rating: 7.0, image: "../images/platform.jpg" },
            { title: "Joker", genre: "Drama", type: "Movie", rating: 8.4, image: "../images/joker.jpg" },
            { title: "Dune", genre: "Sci-Fi", type: "Movie", rating: 8.0, image: "../images/dune.jpg" },
            { title: "Aquaman", genre: "Action", type: "Movie", rating: 6.8, image: "../images/aquaman.jpg" },
            { title: "The Batman", genre: "Action", type: "Movie", rating: 7.8, image: "../images/batman.jpg" },
            { title: "Stranger Things", genre: "Horror", type: "Series", rating: 8.7, image: "../images/stranger_things.jpg" },
            { title: "The Crown", genre: "Drama", type: "Series", rating: 8.6, image: "../images/crown.jpg" },
            { title: "House of Dragon", genre: "Fantasy", type: "Series", rating: 8.5, image: "../images/house_of_dragon.jpg" },
            { title: "Money Heist", genre: "Crime", type: "Series", rating: 8.3, image: "../images/money_heist.jpg" },
            { title: "Breaking Bad", genre: "Crime", type: "Series", rating: 9.5, image: "../images/breakingbad.avif" },
            { title: "The Witcher", genre: "Fantasy", type: "Series", rating: 8.2, image: "../images/witcher.webp" },
            { title: "Mandalorian", genre: "Sci-Fi", type: "Series", rating: 8.7, image: "../images/mandalorian.jpg" },
            { title: "Avengers Endgame", genre: "Action", type: "Movie", rating: 8.4, image: "../images/avengers_endgame.jpg" }
        ];

        // Hero Slider Functionality
        let currentSlide = 0;
        const slides = document.querySelectorAll('.hero-slide');
        const dots = document.querySelectorAll('.slider-dot');
        const totalSlides = slides.length;
        let isTransitioning = false;

        function showSlide(index) {
            if (isTransitioning) return;
            isTransitioning = true;

            // Add slide-out class to current slide
            slides[currentSlide].classList.add('slide-out');

            // Remove active class from all elements
            slides.forEach(slide => slide.classList.remove('active'));
            dots.forEach(dot => dot.classList.remove('active'));

            // After transition delay, show new slide
            setTimeout(() => {
                slides.forEach(slide => slide.classList.remove('slide-out'));
                slides[index].classList.add('active');
                dots[index].classList.add('active');

                setTimeout(() => {
                    isTransitioning = false;
                }, 100);
            }, 200);
        }

        function nextSlide() {
            if (isTransitioning) return;
            const nextIndex = (currentSlide + 1) % totalSlides;
            currentSlide = nextIndex;
            showSlide(currentSlide);
        }

        // Auto-advance slider with pause on hover
        let slideInterval = setInterval(nextSlide, 6000);

        // Pause auto-advance on hover
        const heroSection = document.querySelector('.hero-section');
        heroSection.addEventListener('mouseenter', () => {
            clearInterval(slideInterval);
        });

        heroSection.addEventListener('mouseleave', () => {
            slideInterval = setInterval(nextSlide, 6000);
        });

        // Enhanced dot navigation
        dots.forEach((dot, index) => {
            dot.addEventListener('click', () => {
                if (isTransitioning || index === currentSlide) return;
                currentSlide = index;
                showSlide(currentSlide);
            });
        });

        // Search Functionality
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        const searchResults = document.getElementById('searchResults');

        function performSearch(query) {
            if (!query.trim()) {
                searchResults.style.display = 'none';
                return;
            }

            const filteredResults = searchData.filter(item =>
                item.title.toLowerCase().includes(query.toLowerCase()) ||
                item.genre.toLowerCase().includes(query.toLowerCase()) ||
                item.type.toLowerCase().includes(query.toLowerCase())
            );

            displaySearchResults(filteredResults);
        }

        function displaySearchResults(results) {
            if (results.length === 0) {
                searchResults.innerHTML = '<div class="search-result-item"><p>No results found</p></div>';
            } else {
                searchResults.innerHTML = results.map(item => `
              <div class="search-result-item" onclick="selectSearchResult('${item.title}')">
                  <div class="search-result-image">
                      <img src="${item.image}" alt="${item.title}">
                  </div>
                  <div class="search-result-info">
                      <h4>${item.title}</h4>
                      <p>${item.genre} â€¢ ${item.type} â€¢ â­ ${item.rating}</p>
                  </div>
              </div>
          `).join('');
            }
            searchResults.style.display = 'block';
        }

        function selectSearchResult(title) {
            searchInput.value = title;
            searchResults.style.display = 'none';
            alert(`Opening ${title}...`);
        }

        // Search event listeners
        searchInput.addEventListener('input', (e) => {
            performSearch(e.target.value);
        });

        searchInput.addEventListener('focus', () => {
            if (searchInput.value.trim()) {
                performSearch(searchInput.value);
            }
        });

        searchBtn.addEventListener('click', () => {
            performSearch(searchInput.value);
        });

        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                performSearch(searchInput.value);
            }
        });

        // Hide search results when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.search-container')) {
                searchResults.style.display = 'none';
            }
        });

        // Mobile menu toggle
        const mobileMenuToggle = document.getElementById('mobileMenuToggle');
        const sidebar = document.getElementById('sidebar');

        mobileMenuToggle.addEventListener('click', () => {
            sidebar.style.transform = sidebar.style.transform === 'translateX(0px)' ? 'translateX(-100%)' : 'translateX(0px)';
        });

        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', (e) => {
            if (window.innerWidth <= 1024 && !sidebar.contains(e.target) && !mobileMenuToggle.contains(e.target)) {
                sidebar.style.transform = 'translateX(-100%)';
            }
        });

        // Movie card interactions - now opens popup in db.html
        const trailerPopup = document.getElementById("trailerPopup");
        const trailerPlayer = document.getElementById("trailerPlayer");
        const closePopup = document.getElementById("closePopup");
        const popupMovieTitle = document.getElementById("popupMovieTitle");
        const popupMovieGenre = document.getElementById("popupMovieGenre");
        const popupMovieRating = document.getElementById("popupMovieRating");
        const popupMovieDescription = document.getElementById("popupMovieDescription");

        const movieCards = document.querySelectorAll('.movie-card');
        movieCards.forEach(card => {
            card.addEventListener('click', () => {
                const trailerSrc = card.getAttribute("data-trailer");
                const title = card.getAttribute("data-title");
                const genre = card.getAttribute("data-genre");
                const rating = card.getAttribute("data-rating");
                const description = card.getAttribute("data-description");

                trailerPlayer.src = trailerSrc + "?autoplay=1";
                popupMovieTitle.textContent = title;
                popupMovieGenre.textContent = `Genre: ${genre}`;
                popupMovieRating.textContent = `Rating: â­ ${rating}`;
                popupMovieDescription.textContent = description;

                trailerPopup.style.display = "flex";
            });
        });

        // Close popup
        closePopup.addEventListener("click", () => {
            trailerPopup.style.display = "none";
            trailerPlayer.src = ""; // Stop video playback
        });

        // Close popup when clicking outside of the content
        window.addEventListener("click", (e) => {
            if (e.target === trailerPopup) {
                trailerPopup.style.display = "none";
                trailerPlayer.src = ""; // Stop video playback
            }
        });
  

  // Function to populate Continue Watching section
  async function populateContinueWatching() {
    const continueWatchingContainer = document.getElementById('continueWatchingContainer');
    if (!continueWatchingContainer) {
      console.error('Continue watching container not found!');
      return;
    }

    const currentUserId = localStorage.getItem('user_id');
    if (!currentUserId) {
      continueWatchingContainer.innerHTML = '<p>Sign in to see your watch history</p>';
      return;
    }

    try {
      // Use the new continue-watching API endpoint
      const response = await fetch(`http://localhost:5000/continue-watching/${currentUserId}`, {
        headers: {
          'Authorization': `Bearer ${localStorage.getItem('auth_token')}`
        }
      });

      if (!response.ok) {
        throw new Error('Failed to fetch watch history');
      }

      const data = await response.json();
      const watchHistory = data.watchHistory || [];
      
      if (!watchHistory || watchHistory.length === 0) {
        continueWatchingContainer.innerHTML = '<p>No watch history found. Start watching!</p>';
        return;
      }

      // Create HTML for each watch history item
      const watchHistoryHTML = watchHistory.map(item => {
        if (!item) return '';
        
        return `
          <div class="continue-card" data-id="${item.itemId}">
            <div class="continue-info">
              <div class="continue-poster">
                <img src="${item.posterUrl}" alt="${escapeHtml(item.title)}">
              </div>
              <div class="continue-details">
                <h4>${escapeHtml(item.title)}</h4>
                <p>${item.type || ''}</p>
              </div>
            </div>
            <div class="progress-bar">
              <div class="progress-fill" style="width: ${item.progress || 50}%"></div>
            </div>
          </div>
        `;
      }).join('');

      continueWatchingContainer.innerHTML = watchHistoryHTML;
      
      // Add click event listeners to continue cards
      document.querySelectorAll('.continue-card').forEach(card => {
        card.addEventListener('click', () => {
          const movieId = card.getAttribute('data-id');
          // You could add logic here to resume playback
          openMovieDetails(movieId);
        });
      });
      
    } catch (error) {
      console.error('Error fetching watch history:', error);
      continueWatchingContainer.innerHTML = '<p>Error loading watch history</p>';
    }
  }

  // Call populateContinueWatching on page load
  document.addEventListener('DOMContentLoaded', function() {
    populateContinueWatching();
  });

  // Continue watching interactions
        const continueCards = document.querySelectorAll('.continue-card');
        continueCards.forEach(card => {
            card.addEventListener('click', () => {
                const title = card.querySelector('h4').textContent;
                alert(`Resuming ${title}...`);
            });
        });

        // Navbar scroll effect
        let lastScrollTop = 0;
        const navbar = document.querySelector('.navbar');

        window.addEventListener('scroll', () => {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

            if (scrollTop > lastScrollTop && scrollTop > 100) {
                navbar.style.transform = 'translateY(-100%)';
            } else {
                navbar.style.transform = 'translateY(0)';
            }

            lastScrollTop = scrollTop;
        });

        // Add loading states for auth buttons
        const authButtons = document.querySelectorAll('.auth-btn');
        authButtons.forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.preventDefault();
                btn.style.opacity = '0.7';
                btn.textContent = 'Loading...';

                setTimeout(() => {
                    window.location.href = 'views/login.html';
                }, 500);
            });
        });

        function showGreeting() {
            let now = new Date();
            let hours = now.getHours();
            let greeting;
            if (hours >= 5 && hours < 12) {
                greeting = "Good Morning!";
            } else if (hours >= 12 && hours < 17) {
                greeting = "Good Afternoon!";
            } else if (hours >= 17 && hours < 19) {
                greeting = "Good Evening!";
            } else {
                greeting = "Good Night!";
            }
            document.getElementById("greeting").innerText = greeting;
        }
        // Run greeting on page load
        window.onload = showGreeting;

        /* Updated slider initialization to handle both sliders */
        /* Updated slider initialization to handle both sliders */
    </script>
    <!-- Enhanced Chatbot Styles -->
    <style>
        /* Chatbot Toggle Button */
        .chatbot-toggle {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #33E0B2, #0ef5b5);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 8px 32px rgba(51, 224, 178, 0.3);
            z-index: 2000;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #1a1a2e;
            backdrop-filter: blur(10px);
        }

        .chatbot-toggle:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 12px 40px rgba(51, 224, 178, 0.4);
        }

        .chatbot-toggle:active {
            transform: translateY(0) scale(0.95);
        }

        /* Chatbot Window */
        .chatbot-window {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 380px;
            height: 600px;
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(51, 224, 178, 0.2);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            display: none;
            flex-direction: column;
            z-index: 2000;
            overflow: hidden;
            transform: translateY(20px) scale(0.95);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .chatbot-window.active {
            transform: translateY(0) scale(1);
            opacity: 1;
        }

        /* Chatbot Header */
        .chatbot-header {
            background: linear-gradient(135deg, #33E0B2, #0ef5b5);
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #1a1a2e;
            font-weight: 600;
            font-size: 16px;
        }

        .chatbot-title {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chatbot-close {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #1a1a2e;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .chatbot-close:hover {
            background: rgba(26, 26, 46, 0.2);
            transform: scale(1.1);
        }

        /* Chat Messages Area */
        .chatbot-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .chatbot-messages::-webkit-scrollbar {
            width: 6px;
        }

        .chatbot-messages::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        .chatbot-messages::-webkit-scrollbar-thumb {
            background: rgba(51, 224, 178, 0.3);
            border-radius: 3px;
        }

        .chatbot-messages::-webkit-scrollbar-thumb:hover {
            background: rgba(51, 224, 178, 0.5);
        }

        /* Message Bubbles */
        .message {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.4;
            word-wrap: break-word;
            animation: messageSlide 0.3s ease-out;
        }

        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.bot {
            background: linear-gradient(135deg, rgba(51, 224, 178, 0.2), rgba(14, 245, 181, 0.1));
            border: 1px solid rgba(51, 224, 178, 0.3);
            color: #ffffff;
            align-self: flex-start;
            border-bottom-left-radius: 6px;
        }

        .message.user {
            background: linear-gradient(135deg, #33E0B2, #0ef5b5);
            color: #1a1a2e;
            align-self: flex-end;
            border-bottom-right-radius: 6px;
            font-weight: 500;
        }

        /* Typing Indicator */
        .typing-indicator {
            display: none;
            align-self: flex-start;
            background: rgba(51, 224, 178, 0.1);
            border: 1px solid rgba(51, 224, 178, 0.2);
            border-radius: 18px;
            border-bottom-left-radius: 6px;
            padding: 12px 16px;
            max-width: 80px;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            background: #33E0B2;
            border-radius: 50%;
            animation: typingDot 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typingDot {
            0%, 80%, 100% {
                transform: scale(0.8);
                opacity: 0.5;
            }
            40% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* Quick Options */
        .chatbot-options {
            padding: 15px 20px;
            border-top: 1px solid rgba(51, 224, 178, 0.1);
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .option-btn {
            background: rgba(51, 224, 178, 0.1);
            border: 1px solid rgba(51, 224, 178, 0.3);
            color: #33E0B2;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .option-btn:hover {
            background: rgba(51, 224, 178, 0.2);
            transform: translateY(-1px);
        }

        /* Input Area */
        .chatbot-input-area {
            padding: 20px;
            border-top: 1px solid rgba(51, 224, 178, 0.1);
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .chatbot-input {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(51, 224, 178, 0.2);
            border-radius: 25px;
            padding: 12px 20px;
            color: #ffffff;
            font-size: 14px;
            outline: none;
            transition: all 0.3s ease;
        }

        .chatbot-input:focus {
            border-color: #33E0B2;
            box-shadow: 0 0 0 3px rgba(51, 224, 178, 0.1);
        }

        .chatbot-input::placeholder {
            color: #8892b0;
        }

        .chatbot-send {
            background: linear-gradient(135deg, #33E0B2, #0ef5b5);
            border: none;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #1a1a2e;
            font-size: 16px;
        }

        .chatbot-send:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(51, 224, 178, 0.3);
        }

        .chatbot-send:active {
            transform: scale(0.95);
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .chatbot-window {
                width: calc(100vw - 40px);
                height: calc(100vh - 120px);
                right: 20px;
                bottom: 80px;
            }
            
            .chatbot-toggle {
                right: 20px;
                bottom: 20px;
            }
        }
    </style>

    <!-- Floating Chatbot Toggle -->
    <button id="chat-toggle" class="chatbot-toggle">
        ðŸ’¬
    </button>

    <!-- Chatbot Window -->
    <div id="chatbot" class="chatbot-window">
        <div class="chatbot-header">
            <div class="chatbot-title">
                <span>ðŸ¤–</span>
                <span>PrimeVision Assistant</span>
            </div>
            <button id="chat-close" class="chatbot-close">Ã—</button>
        </div>
        
        <div id="chatbox" class="chatbot-messages"></div>
        
        <div id="typing-indicator" class="typing-indicator">
            <div class="typing-dots">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            </div>
        </div>
        
        <div id="options" class="chatbot-options"></div>
        
        <div class="chatbot-input-area">
            <input id="userInput" type="text" class="chatbot-input" placeholder="Type your message...">
            <button onclick="sendMessage()" class="chatbot-send">âž¤</button>
        </div>
    </div>

</body>
<script>
  // Enhanced Chatbot Functionality
  const chatbox = document.getElementById("chatbox");
  const optionsDiv = document.getElementById("options");
  const typingIndicator = document.getElementById("typing-indicator");
  const chatToggle = document.getElementById("chat-toggle");
  const chatWindow = document.getElementById("chatbot");
  const chatClose = document.getElementById("chat-close");
  const userInput = document.getElementById("userInput");

  const responses = {
    "hi": "ðŸ‘‹ Hello! Welcome to PrimeVision. How can I help you today?",
    "hello": "ðŸ‘‹ Hi there! I'm your PrimeVision assistant. What would you like to know?",
    "plan": "ðŸ“Œ We offer three subscription plans: Basic (â‚¹199), Standard (â‚¹499), and Premium (â‚¹799).",
    "basic": "âœ… Basic Plan: â‚¹199/month â€“ 1 screen, SD quality, access to our full library.",
    "standard": "âœ… Standard Plan: â‚¹499/month â€“ 2 screens, HD quality, offline downloads.",
    "premium": "âœ… Premium Plan: â‚¹799/month â€“ 4 screens, Ultra HD quality, exclusive content.",
    "watchlist": "ðŸ“Œ You can save movies and shows to your Watchlist for later viewing. Just click the bookmark icon!",
    "bye": "ðŸ‘‹ Goodbye! Enjoy streaming on PrimeVision. Have a great day!",
    "action": "ðŸ’¥ Popular Action Movies: John Wick, Mad Max: Fury Road, The Dark Knight, Mission Impossible.",
    "comedy": "ðŸ˜‚ Comedy Movies: The Hangover, Jumanji, 3 Idiots, Deadpool, The Office.",
    "romance": "ðŸ’• Romance Movies: The Notebook, La La Land, DDLJ, Titanic, Pride & Prejudice.",
    "horror": "ðŸ‘» Horror Movies: The Conjuring, IT, Train to Busan, Hereditary, The Exorcist.",
    "sci-fi": "ðŸš€ Sci-Fi Movies: Interstellar, Inception, The Matrix, Blade Runner, Dune.",
    "drama": "ðŸŽ­ Drama Movies: Shawshank Redemption, Parasite, Joker, The Godfather, Schindler's List.",
    "show": "ðŸ“º Popular Shows: Stranger Things, Money Heist, The Witcher, Breaking Bad, Game of Thrones.",
    "help": "ðŸ¤– I can help you with subscription plans, movie recommendations, show information, and general questions about PrimeVision!",
    "contact": "ðŸ“ž For support, email us at support@primevision.com or call +91-800-123-4567",
    "download": "ðŸ“± Download our mobile app from App Store or Google Play for offline viewing!"
  };

  // Enhanced message function with proper styling
  function addMessage(sender, text, isUser = false) {
    const messageDiv = document.createElement("div");
    messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
    messageDiv.textContent = text;
    
    chatbox.appendChild(messageDiv);
    chatbox.scrollTop = chatbox.scrollHeight;
  }

  // Show typing indicator
  function showTyping() {
    typingIndicator.style.display = "flex";
    chatbox.scrollTop = chatbox.scrollHeight;
  }

  // Hide typing indicator
  function hideTyping() {
    typingIndicator.style.display = "none";
  }

  // Enhanced options display
  function showOptions(options) {
    optionsDiv.innerHTML = "";
    options.forEach(opt => {
      const btn = document.createElement("button");
      btn.className = "option-btn";
      btn.textContent = opt.label;
      btn.onclick = opt.action;
      optionsDiv.appendChild(btn);
    });
  }

  // Start chat with welcome message
  function startChat() {
    chatbox.innerHTML = "";
    addMessage("PrimeVision Assistant", "ðŸ‘‹ Hi! I'm your PrimeVision assistant. How can I help you today?");
    
    setTimeout(() => {
      showOptions([
        { label: "ðŸ“Œ Subscription Plans", action: showPlans },
        { label: "ðŸŽ¬ Movie Categories", action: showCategories },
        { label: "ðŸ“º Popular Shows", action: showShows },
        { label: "ðŸ“± App Features", action: showFeatures },
        { label: "âŒ Close Chat", action: () => closeChat() }
      ]);
    }, 500);
  }

  // Show subscription plans
  function showPlans() {
    showTyping();
    setTimeout(() => {
      hideTyping();
      addMessage("PrimeVision Assistant", "Here are our subscription plans:");
      addMessage("PrimeVision Assistant", "âœ… Basic: â‚¹199/month â€“ 1 screen, SD quality");
      addMessage("PrimeVision Assistant", "âœ… Standard: â‚¹499/month â€“ 2 screens, HD quality");
      addMessage("PrimeVision Assistant", "âœ… Premium: â‚¹799/month â€“ 4 screens, Ultra HD quality");
      showOptions([{ label: "â¬… Back to Menu", action: startChat }]);
    }, 1000);
  }

  // Show movie categories
  function showCategories() {
    showTyping();
    setTimeout(() => {
      hideTyping();
      addMessage("PrimeVision Assistant", "Choose a movie category:");
      showOptions([
        { label: "ðŸ’¥ Action", action: () => recommend("Action", ["John Wick", "Mad Max: Fury Road", "The Dark Knight", "Mission Impossible"]) },
        { label: "ðŸ˜‚ Comedy", action: () => recommend("Comedy", ["The Hangover", "Jumanji", "3 Idiots", "Deadpool"]) },
        { label: "ðŸ’• Romance", action: () => recommend("Romance", ["The Notebook", "La La Land", "DDLJ", "Titanic"]) },
        { label: "ðŸ‘» Horror", action: () => recommend("Horror", ["The Conjuring", "IT", "Train to Busan", "Hereditary"]) },
        { label: "ðŸš€ Sci-Fi", action: () => recommend("Sci-Fi", ["Interstellar", "Inception", "The Matrix", "Blade Runner"]) },
        { label: "ðŸŽ­ Drama", action: () => recommend("Drama", ["Shawshank Redemption", "Parasite", "Joker", "The Godfather"]) },
        { label: "â¬… Back to Menu", action: startChat }
      ]);
    }, 800);
  }

  // Show recommendations
  function recommend(category, movies) {
    showTyping();
    setTimeout(() => {
      hideTyping();
      addMessage("PrimeVision Assistant", `${category} Movies: ${movies.join(", ")}`);
      showOptions([{ label: "â¬… Back to Categories", action: showCategories }]);
    }, 1000);
  }

  // Show popular shows
  function showShows() {
    showTyping();
    setTimeout(() => {
      hideTyping();
      addMessage("PrimeVision Assistant", "ðŸ“º Popular Shows: Stranger Things, Money Heist, The Witcher, Breaking Bad, Game of Thrones");
      showOptions([{ label: "â¬… Back to Menu", action: startChat }]);
    }, 1000);
  }

  // Show app features
  function showFeatures() {
    showTyping();
    setTimeout(() => {
      hideTyping();
      addMessage("PrimeVision Assistant", "ðŸ“± App Features:");
      addMessage("PrimeVision Assistant", "â€¢ Offline Downloads");
      addMessage("PrimeVision Assistant", "â€¢ Multiple Device Support");
      addMessage("PrimeVision Assistant", "â€¢ Parental Controls");
      addMessage("PrimeVision Assistant", "â€¢ 4K Ultra HD Streaming");
      showOptions([{ label: "â¬… Back to Menu", action: startChat }]);
    }, 1000);
  }

  // Send message function
  function sendMessage() {
    const userText = userInput.value.trim();
    if (userText === "") return;

    addMessage(userText, true);
    userInput.value = "";

    // Show typing indicator
    showTyping();

    // Simulate bot response delay
    setTimeout(() => {
      hideTyping();
      
      let botResponse = "âŒ Sorry, I didn't understand that. Try selecting an option or type 'help' for assistance.";
      
      // Check for keyword matches
      for (let key in responses) {
        if (userText.toLowerCase().includes(key)) {
          botResponse = responses[key];
          break;
        }
      }

      addMessage("PrimeVision Assistant", botResponse);
      
      // Show options after response
      setTimeout(() => {
        showOptions([
          { label: "ðŸ“Œ Plans", action: showPlans },
          { label: "ðŸŽ¬ Movies", action: showCategories },
          { label: "ðŸ“º Shows", action: showShows },
          { label: "âŒ Close", action: () => closeChat() }
        ]);
      }, 500);
    }, 1500);
  }

  // Close chat function
  function closeChat() {
    chatWindow.classList.remove("active");
    setTimeout(() => {
      chatWindow.style.display = "none";
    }, 300);
  }

  // Open chat function
  function openChat() {
    chatWindow.style.display = "flex";
    setTimeout(() => {
      chatWindow.classList.add("active");
    }, 10);
    startChat();
  }

  // Event listeners
  chatToggle.onclick = openChat;
  chatClose.onclick = closeChat;

  // Enter key support
  userInput.addEventListener("keypress", function(e) {
    if (e.key === "Enter") {
      sendMessage();
    }
  });

  // Click outside to close
  document.addEventListener("click", function(e) {
    if (!chatWindow.contains(e.target) && !chatToggle.contains(e.target)) {
      if (chatWindow.classList.contains("active")) {
        closeChat();
      }
    }
  });
</script>
<script>
  async function loadAllMovies(){
    try {
      // Fetch and populate "You Might Like" section
      console.log('Fetching movies from API endpoint: you-might-like');
      const youGrid = document.getElementById('youMightLikeGrid');
      if (youGrid) {
        youGrid.innerHTML = '';
        try {
          const youRes = await fetch('http://localhost:5000/you-might-like');
          const youData = await youRes.json();
          const youMovies = Array.isArray(youData) ? youData : (youData.shows || []);
          const youCardsHtml = youMovies.map(m => generateMovieCardHTML(m)).join('');
          youGrid.innerHTML = youCardsHtml;
        } catch (err) {
          console.error('Failed to load shows for #youMightLikeGrid:', err);
          youGrid.innerHTML = '<div class="error-message">Unable to load recommendations</div>';
        }
      }
      
      // Fetch and populate "Popular Now" section
      console.log('Fetching movies from API endpoint: popular');
      const popularGrid = document.getElementById('popularNowGrid');
      if (popularGrid) {
        popularGrid.innerHTML = '';
        try {
          const popularRes = await fetch('http://localhost:5000/popular');
          const popularData = await popularRes.json();
          const popularMovies = Array.isArray(popularData) ? popularData : (popularData.shows || []);
          const popularCardsHtml = popularMovies.map(m => generateMovieCardHTML(m)).join('');
          popularGrid.innerHTML = popularCardsHtml;
        } catch (err) {
          console.error('Failed to load shows for #popularNowGrid:', err);
          popularGrid.innerHTML = '<div class="error-message">Unable to load popular shows</div>';
        }
      }
    } catch (err) {
      console.error('Failed to load shows:', err);
    }
  }

  function generateMovieCardHTML(movie){
    const title = movie.title || '';
    const poster = movie.poster_url || '';
    const rating = (movie.rating != null) ? movie.rating : '';
    const genres = Array.isArray(movie.genres) ? movie.genres.join(' â€¢ ') : (movie.genre || '');
    const description = movie.description || '';
    const trailer = movie.trailer_url || '';
    const id = movie._id || '';
    return `
      <div class="movie-card" data-id="${id}" data-trailer="${trailer}" data-title="${escapeHtml(title)}" data-genre="${escapeHtml(genres)}" data-rating="${rating}" data-description="${escapeHtml(description)}">
        <div class="movie-poster">
          <img src="${poster}" alt="${escapeHtml(title)}">
        </div>
        <div class="movie-info">
          <div class="title-row">
            <h3 class="movie-title1">${escapeHtml(title)}</h3>
          </div>
          <p class="movie-genre">${escapeHtml(genres)}</p>
          <div class="movie-rating"><span>â­</span><span>${rating}</span></div>
          <button class="toggle-desc-btn">Show Description<span class="arrow"></span></button>
          <p class="movie-description" style="display: none; margin-top: 10px; color: #b0b8c9;"></p>
        </div>
      </div>
    `;
  }

  function escapeHtml(str){
    return String(str).replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[s]));
  }

  document.addEventListener('DOMContentLoaded', loadAllMovies);
</script>
<script>
  function createMovieCard(movie){
    const id = movie._id || '';
    const title = movie.title || '';
    const poster = movie.poster_url || '';
    const rating = (movie.rating != null) ? movie.rating : '';
    const genres = Array.isArray(movie.genres) ? movie.genres.join(' â€¢ ') : '';
    const description = movie.description || '';
    const trailer = movie.trailer_url || '';
    return (
      '<div class="movie-card" data-id="'+id+'" data-trailer="'+trailer+'" data-title="'+escapeHtml(title)+'" data-genre="'+escapeHtml(genres)+'" data-rating="'+rating+'" data-description="'+escapeHtml(description)+'">'
      +  '<div class="movie-poster">'
      +    '<img src="'+poster+'" alt="'+escapeHtml(title)+'">'
      +  '</div>'
      +  '<div class="movie-info">'
      +    '<div class="title-row">'
      +      '<h3 class="movie-title1">'+escapeHtml(title)+'</h3>'
      +    '</div>'
      +    '<p class="movie-genre">'+escapeHtml(genres)+'</p>'
      +    '<div class="movie-rating"><span>â­</span><span>'+rating+'</span></div>'
      +    '<button class="toggle-desc-btn">Show Description<span class="arrow"></span></button>'
      +    '<p class="movie-description" style="display: none; margin-top: 10px; color: #b0b8c9;"></p>'
      +  '</div>'
      +'</div>'
    );
  }

  async function populateSection(endpoint, containerSelector) {
    try {
      console.log(`Fetching movies from API endpoint: ${endpoint}`);
      // Fixed endpoint URL to match backend routes
      const res = await fetch(`http://localhost:5000/${endpoint}`);
      console.log('API response status:', res.status);
      const data = await res.json();
      console.log('API data received:', data);
      const movies = Array.isArray(data) ? data : (data.shows || []);
      console.log('Movies array:', movies);
      const container = document.querySelector(containerSelector);
      console.log(`Container ${containerSelector} found:`, container);
      if (!container) {
        console.error(`Container ${containerSelector} not found!`);
        return;
      }
      container.innerHTML = movies.map(createMovieCard).join('');
      console.log(`Movies loaded successfully for ${containerSelector}`);
    } catch(err) {
      console.error(`Failed to load shows for ${containerSelector}:`, err);
    }
  }

  function escapeHtml(str){
    return String(str).replace(/[&<>"']/g, function(s){return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[s]);});
  }

  async function fetchAndDisplayRecommendations(movieId) {
    const recommendationsContainer = document.querySelector('#recommendations-container');
    if (!recommendationsContainer) {
      console.error('Recommendations container not found!');
      return;
    }
    
    // Show loading message
    recommendationsContainer.innerHTML = '<p>Finding recommendations for you...</p>';
    
    try {
      const response = await fetch(`http://localhost:5000/api/shows/recommendations/${movieId}`);
      
      if (!response.ok) {
        throw new Error(`API returned status ${response.status}`);
      }
      
      const data = await response.json();
      
      if (!data || !Array.isArray(data) || data.length === 0) {
        recommendationsContainer.innerHTML = '<p class="no-recommendations">No recommendations found for this movie.</p>';
        return;
      }
      
      // Save recommendations to the database if user is logged in
      const currentUserId = localStorage.getItem('user_id');
      if (currentUserId) {
        try {
          // Save each recommendation to the database
          for (const movie of data) {
            await fetch(`http://localhost:5000/recommendations/${currentUserId}`, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${localStorage.getItem('auth_token')}`
              },
              body: JSON.stringify({
                itemId: movie._id,
                title: movie.title,
                type: 'movie',
                posterUrl: movie.poster_url,
                rating: movie.rating,
                genres: movie.genres
              })
            });
          }
          console.log('Recommendations saved to database');
        } catch (saveError) {
          console.error('Error saving recommendations to database:', saveError);
          // Continue even if saving fails - we'll still display the recommendations
        }
      }
      
      // Generate movie cards for recommendations
      const recommendationCards = data.map(createMovieCard).join('');
      recommendationsContainer.innerHTML = `
        <div class="recommendations-grid movies-grid">
          ${recommendationCards}
        </div>
      `;
    } catch (error) {
      console.error('Error fetching recommendations:', error);
      recommendationsContainer.innerHTML = '<p class="error-message">Failed to load recommendations. Please try again later.</p>';
    }
  }

  // New comprehensive function to handle movie card clicks
  async function handleMovieCardClick(movieId) {
    if (!movieId) return;
    
    const currentUserId = localStorage.getItem('user_id');
    const authToken = localStorage.getItem('auth_token');
    
    // Step A: Fetch and display new recommendations
    console.log('Step A: Fetching recommendations for movie ID:', movieId);
    try {
      const response = await fetch(`http://localhost:5000/recommendations/${movieId}`);
      
      if (!response.ok) {
        throw new Error(`API returned status ${response.status}`);
      }
      
      const recommendations = await response.json();
      
      // Display recommendations
      const recommendationsContainer = document.querySelector('#recommendations-container');
      if (recommendationsContainer) {
        if (!recommendations || !Array.isArray(recommendations) || recommendations.length === 0) {
          recommendationsContainer.innerHTML = '<p class="no-recommendations">No recommendations found for this movie.</p>';
        } else {
          // Generate movie cards for recommendations
          const recommendationCards = recommendations.map(createMovieCard).join('');
          recommendationsContainer.innerHTML = `
            <div class="recommendations-grid movies-grid">
              ${recommendationCards}
            </div>
          `;
        }
        
        // Scroll recommendations into view
        document.querySelector('.recommendations-section').scrollIntoView({ behavior: 'smooth' });
      }
      
      // Step B: Save recommendations to user's profile
      if (currentUserId && authToken && recommendations && recommendations.length > 0) {
        console.log('Step B: Saving recommendations to user profile');
        
        const saveResponse = await fetch('http://localhost:5000/recommendations', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${authToken}`
          },
          body: JSON.stringify({
            userId: currentUserId,
            sourceShowId: movieId,
            recommendations: recommendations.map(rec => rec._id)
          })
        });
        
        if (!saveResponse.ok) {
          throw new Error('Failed to save recommendations');
        }
        
        console.log('Recommendations saved successfully');
      }
      
      // Step C: Log the clicked movie to watch history
      if (currentUserId && authToken) {
        console.log('Step C: Logging movie to watch history');
        
        const watchHistoryResponse = await fetch('http://localhost:5000/continue-watching', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${authToken}`
          },
          body: JSON.stringify({
            userId: currentUserId,
            showId: movieId
          })
        });
        
        if (!watchHistoryResponse.ok) {
          throw new Error('Failed to update watch history');
        }
        
        console.log('Watch history updated successfully');
        
        // Refresh continue watching section
        populateContinueWatching();
      }
      
    } catch (error) {
      console.error('Error in handleMovieCardClick:', error);
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    // Populate sections with their respective endpoints
    populateSection('popular', '#popularNowGrid'); // Popular movies
    populateSection('you-might-like', '#youMightLikeGrid'); // You might like section
    
    // Load user's recommendations from database if logged in
    loadUserRecommendations();
    
    // Add click event listeners for movie recommendations
    document.addEventListener('click', (event) => {
      // Find the closest movie card to the clicked element
      const movieCard = event.target.closest('.movie-card');
      if (movieCard) {
        const movieId = movieCard.getAttribute('data-id');
        if (movieId) {
          handleMovieCardClick(movieId);
        }
      }
    });
  });
  
  // Function to load user's recommendations from the database
  async function loadUserRecommendations() {
    const recommendationsContainer = document.querySelector('#recommendations-container');
    if (!recommendationsContainer) return;
    
    const currentUserId = localStorage.getItem('user_id');
    const authToken = localStorage.getItem('auth_token');
    
    if (currentUserId && authToken) {
      try {
        // Fetch user's recommendations from the database
        const response = await fetch(`http://localhost:5000/recommendations/${currentUserId}`, {
          headers: {
            'Authorization': `Bearer ${authToken}`
          }
        });
        
        if (!response.ok) {
          throw new Error(`API returned status ${response.status}`);
        }
        
        const data = await response.json();
        
        if (data && data.recommendations && data.recommendations.length > 0) {
          // Generate movie cards for recommendations
          const recommendationCards = data.recommendations.map(item => {
            return `
              <div class="movie-card" data-id="${item.itemId}">
                <div class="movie-poster">
                  <img src="${item.posterUrl || '/placeholder.svg?height=200&width=280'}" alt="${escapeHtml(item.title)}">
                  <div class="movie-actions">
                    <button class="watch-btn">Watch Now</button>
                    <button class="add-list-btn">+ Add to List</button>
                  </div>
                </div>
                <div class="movie-info">
                  <div class="title-row">
                    <h3 class="movie-title1">${escapeHtml(item.title)}</h3>
                  </div>
                  <div class="movie-meta">
                    <span class="movie-rating">${item.rating || 'N/A'}</span>
                  </div>
                </div>
              </div>
            `;
          }).join('');
          
          recommendationsContainer.innerHTML = `
            <div class="recommendations-grid movies-grid">
              ${recommendationCards}
            </div>
          `;
        }
      } catch (error) {
        console.error('Error loading user recommendations:', error);
      }
    }
  }
</script>
<script>
  (function(){
    function timeOfDay(){
      const h = new Date().getHours();
      if (h < 12) return 'Good morning';
      if (h < 17) return 'Good afternoon';
      return 'Good evening';
    }
    function firstNameOf(fullName){
      if(!fullName) return '';
      return fullName.trim().split(/\s+/)[0];
    }
    function setGreeting(){
      try {
        const name = localStorage.getItem('user_full_name') || '';
        const greeting = name ? `${timeOfDay()}, ${firstNameOf(name)}` : `${timeOfDay()}!`;
        const logoP = document.querySelector('.logo-container p');
        if (logoP) logoP.textContent = greeting;
        const anyGreetingEl = document.getElementById('greetingText');
        if (anyGreetingEl) anyGreetingEl.textContent = greeting;
      } catch(e) {}
    }
    let greetingTimer;
    function refreshFromApi(){
      const token = localStorage.getItem('auth_token');
      if(!token) { setGreeting(); return; }
      fetch('http://localhost:5000/users/me', {
        headers: { 'Authorization': `Bearer ${token}` }
      }).then(r => r.json()).then(data => {
        if(data && data.user){
          localStorage.setItem('user_full_name', data.user.fullName || '');
          localStorage.setItem('user_email', data.user.email || '');
          setGreeting();
        } else {
          setGreeting();
        }
      }).catch(() => setGreeting());
      if (greetingTimer) clearTimeout(greetingTimer);
      greetingTimer = setTimeout(setGreeting, 60 * 1000); // keep stable and refresh each minute
    }
    function renderAuthButtons(){
      const navRight = document.querySelector('.auth-buttons, .user-actions');
      if (!navRight) return;
      const token = localStorage.getItem('auth_token');
      if (token) {
        navRight.innerHTML = '<button class="auth-btn signup-btn" id="navSignOut">Sign Out</button>';
        document.getElementById('navSignOut').addEventListener('click', function(){
          try { localStorage.removeItem('auth_token'); } catch(e) {}
          window.location.href = 'views/login.html';
        });
      } else {
        navRight.innerHTML = '<button class="auth-btn signin-btn" id="navSignIn">Sign In</button>';
        document.getElementById('navSignIn').addEventListener('click', function(){
          window.location.href = 'views/login.html';
        });
      }
    }
    document.addEventListener('DOMContentLoaded', function(){
      renderAuthButtons();
      refreshFromApi();
    });
  })();
</script>
<script>
  (function(){
    function createButton(label){
      const btn = document.createElement('button');
      btn.className = 'add-fav-pill';
      btn.setAttribute('aria-label', 'Add to favourites');
      btn.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78L12 21.23l8.84-8.84a5.5 5.5 0 0 0 0-7.78z"/></svg>`;
      return btn;
    }
    function extractCardData(card){
      const titleEl = card.querySelector('.movie-title1, .fav-title, h3, h4, .title');
      const title = titleEl ? titleEl.textContent.trim() : '';
      let posterUrl = '';
      const img = card.querySelector('img');
      if (img && img.src) posterUrl = img.src;
      if (!posterUrl){
        const bg = card.querySelector('[style*="background-image"]');
        if (bg){
          const m = bg.getAttribute('style').match(/url\(['\"]?(.*?)['\"]?\)/);
          if (m && m[1]) posterUrl = m[1];
        }
      }
      const type = 'movie';
      const itemId = (title || posterUrl || Math.random().toString(36).slice(2)).toLowerCase().replace(/[^a-z0-9]+/g,'-').slice(0,60);
      return { itemId, title, type, posterUrl };
    }
    async function addToFav(data){
      const token = localStorage.getItem('auth_token');
      if (!token){ window.location.href = 'views/login.html'; return; }
      try{
        const res = await fetch('http://localhost:5000/users/me/favourites',{
          method:'POST',
          headers:{ 'Content-Type':'application/json', 'Authorization': `Bearer ${token}` },
          body: JSON.stringify(data)
        });
        const out = await res.json();
        if (!res.ok) throw new Error(out.message || 'Failed');
        showToast('Added to favourites');
      }catch(e){
        alert(e.message || 'Failed to add to favourites');
      }
    }
    function showToast(msg){
      let el = document.getElementById('globalToast');
      if(!el){
        el = document.createElement('div');
        el.id = 'globalToast';
        el.className = 'toast';
        document.body.appendChild(el);
      }
      el.textContent = msg;
      requestAnimationFrame(()=>{ el.style.opacity = '1'; el.style.transform = 'translateY(0)'; });
      setTimeout(()=>{ el.style.opacity = '0'; el.style.transform = 'translateY(-10px)'; }, 1600);
    }
    function wireCards(){
      const candidates = document.querySelectorAll('.movie-card, .content-card');
      candidates.forEach(card => {
        if (card.__favWired) return; card.__favWired = true;
        const btn = createButton('Add to Favourites');
        btn.addEventListener('click', (e)=>{
          e.stopPropagation();
          e.preventDefault();
          const data = extractCardData(card);
          if (!data.title){ alert('Unable to detect item title'); return; }
          addToFav(data).then(()=> btn.classList.add('added'));
        });
        const info = card.querySelector('.movie-description, .content-info, .fav-info, .title-row') || card;
        info.appendChild(btn);
      });
      // Also add to hero section primary slide
      document.querySelectorAll('.hero-buttons').forEach(container => {
        if (container.querySelector('.add-fav-btn')) return;
        const btn = createButton('Add to Favourites');
        btn.classList.add('add-fav-btn');
        btn.addEventListener('click', (e)=>{
          e.preventDefault();
          const slide = container.closest('.hero-slide') || document;
          const titleEl = slide.querySelector('.hero-text h1');
          const title = titleEl ? titleEl.textContent.trim() : 'Featured';
          let posterUrl = '';
          const bg = slide.querySelector('[style*="background-image"]');
          if (bg){
            const m = bg.getAttribute('style').match(/url\(['\"]?(.*?)['\"]?\)/);
            if (m && m[1]) posterUrl = m[1];
          }
          addToFav({ itemId: title.toLowerCase().replace(/[^a-z0-9]+/g,'-'), title, type:'movie', posterUrl }).then(()=> btn.classList.add('added'));
        });
        container.appendChild(btn);
      });
    }
    document.addEventListener('DOMContentLoaded', wireCards);
  })();
</script>

</script>

<!-- JavaScript for Movie Trailer Modal -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Select modal elements
    const modal = document.getElementById('movie-modal');
    const closeBtn = document.querySelector('.close-modal');
    const trailerFrame = document.getElementById('trailer-frame');
    const modalTitle = document.getElementById('modal-title');
    const modalDescription = document.getElementById('modal-description');
    
    // Event delegation for movie card clicks
    document.body.addEventListener('click', function(event) {
      const movieCard = event.target.closest('.movie-card');
      if (movieCard) {
        event.preventDefault();
        
        // Get movie data from card attributes
        const trailer = movieCard.getAttribute('data-trailer');
        const title = movieCard.getAttribute('data-title');
        const description = movieCard.getAttribute('data-description');
        const movieId = movieCard.getAttribute('data-id');
        
        // Set modal content
        trailerFrame.src = trailer;
        modalTitle.textContent = title;
        modalDescription.textContent = description;
        
        // Show modal
        modal.classList.add('modal-active');
        
        // Log watch history if user is logged in
        const currentUserId = localStorage.getItem('user_id');
        const authToken = localStorage.getItem('auth_token');
        
        if (currentUserId && authToken && movieId) {
          // Get poster URL and other details from the movie card
          const posterUrl = movieCard.querySelector('img')?.src || '';
          const genres = movieCard.getAttribute('data-genre') || '';
          
          // Send watch history to the new continue-watching API endpoint
          fetch(`http://localhost:5000/continue-watching/${currentUserId}`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${authToken}`
            },
            body: JSON.stringify({
              itemId: movieId,
              title: title,
              type: genres.split(' â€¢ ')[0] || 'Movie',
              posterUrl: posterUrl,
              progress: 50, // Default progress value
              lastWatched: new Date().toISOString()
            })
          })
          .then(response => {
            if (!response.ok) {
              throw new Error('Failed to update watch history');
            }
            return response.json();
          })
          .then(data => {
            console.log('Watch history updated:', data);
            // Refresh continue watching section
            populateContinueWatching();
          })
          .catch(error => {
            console.error('Error updating watch history:', error);
          });
        }
      }
    });
    
    // Close modal when clicking the close button
    closeBtn.addEventListener('click', function() {
      modal.classList.remove('modal-active');
      trailerFrame.src = ''; // Stop video playback
    });
    
    // Close modal when clicking outside the modal content
    modal.addEventListener('click', function(event) {
      if (event.target === modal) {
        modal.classList.remove('modal-active');
        trailerFrame.src = ''; // Stop video playback
      }
    });
  });
</script>

<!-- Movie Trailer Modal -->
<div id="movie-modal" class="movie-modal">
  <div class="modal-content">
    <span class="close-modal">&times;</span>
    <div class="modal-body">
      <div class="trailer-container">
        <iframe id="trailer-frame" width="560" height="315" frameborder="0" allowfullscreen></iframe>
      </div>
      <div class="movie-details">
        <h2 id="modal-title"></h2>
        <p id="modal-description"></p>
      </div>
    </div>
  </div>
</div>

<style>
  /* Clean up: remove old hide/dislike controls visually */
  .hide-btn, .toggle-desc-btn, .dislike-btn, .dislike-icon, .arrow { display:none !important; }
  /* Compact title row without hide control space */
  .title-row { justify-content: flex-start; }
  
  /* Modal Styles */
  .movie-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    z-index: 1000;
    justify-content: center;
    align-items: center;
  }
  
  .modal-active {
    display: flex;
  }
  
  .modal-content {
    background-color: #1a1a1a;
    width: 90%;
    max-width: 1000px;
    border-radius: 8px;
    position: relative;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
  }
  
  .close-modal {
    position: absolute;
    top: 10px;
    right: 15px;
    font-size: 28px;
    color: #fff;
    cursor: pointer;
    z-index: 1001;
  }
  
  .modal-body {
    padding: 20px;
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
  }
  
  .trailer-container {
    flex: 1 1 60%;
    min-width: 300px;
  }
  
  .trailer-container iframe {
    width: 100%;
    height: 315px;
  }
  
  .movie-details {
    flex: 1 1 40%;
    padding: 0 20px;
    min-width: 250px;
    color: #fff;
  }
  
  #modal-title {
    margin-top: 0;
    color: #e50914;
  }
  
  @media (max-width: 768px) {
    .modal-body {
      flex-direction: column;
    }
    
    .movie-details {
      padding: 20px 0 0 0;
    }
  }
</style>

</html>